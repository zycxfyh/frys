name: ğŸ“Š Status Badges Update

# ä»…åœ¨ä¸»åˆ†æ”¯æ¨é€æ—¶è¿è¡Œ
on:
  push:
    branches: [main]
    paths:
      - '.github/workflows/**'
      - 'README.md'

  # å…è®¸æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

jobs:
  update-badges:
    name: 'æ›´æ–°çŠ¶æ€å¾½ç« '
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ğŸ” è¯»å–å½“å‰README
        id: read-readme
        run: |
          content=$(cat README.md)
          echo "readme_content<<EOF" >> $GITHUB_OUTPUT
          echo "$content" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT

      - name: ğŸ“Š ç”ŸæˆçŠ¶æ€å¾½ç« 
        id: badges
        run: |
          # CI/CD æµæ°´çº¿çŠ¶æ€å¾½ç« 
          ci_badge="[![CI/CD Pipeline](https://img.shields.io/github/actions/workflow/status/${{ github.repository }}/ci-cd-pipeline.yml?branch=main&style=flat-square&logo=github)](https://github.com/${{ github.repository }}/actions/workflows/ci-cd-pipeline.yml)"

          # ä»£ç è¦†ç›–ç‡å¾½ç«  (å¦‚æœé…ç½®äº†Codecov)
          coverage_badge="[![Code Coverage](https://img.shields.io/codecov/c/github/${{ github.repository }}?style=flat-square&logo=codecov)](https://codecov.io/gh/${{ github.repository }})"

          # æœ€åæäº¤æ—¶é—´
          last_commit_badge="[![Last Commit](https://img.shields.io/github/last-commit/${{ github.repository }}/main?style=flat-square&logo=github)](https://github.com/${{ github.repository }}/commits/main)"

          # è¾“å‡ºæ‰€æœ‰å¾½ç« 
          echo "ci_badge=$ci_badge" >> $GITHUB_OUTPUT
          echo "coverage_badge=$coverage_badge" >> $GITHUB_OUTPUT
          echo "last_commit_badge=$last_commit_badge" >> $GITHUB_OUTPUT

      - name: ğŸ“ æ›´æ–°READMEå¾½ç« 
        run: |
          # è¿™é‡Œå¯ä»¥å®ç°è‡ªåŠ¨æ›´æ–°READMEä¸­çš„å¾½ç« 
          # æš‚æ—¶åªè¾“å‡ºä¿¡æ¯
          echo "CI/CD å¾½ç« : ${{ steps.badges.outputs.ci_badge }}"
          echo "è¦†ç›–ç‡å¾½ç« : ${{ steps.badges.outputs.coverage_badge }}"
          echo "æœ€åæäº¤å¾½ç« : ${{ steps.badges.outputs.last_commit_badge }}"

          echo "## ğŸ“Š å·¥ä½œæµçŠ¶æ€" >> $GITHUB_STEP_SUMMARY
          echo "${{ steps.badges.outputs.ci_badge }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "${{ steps.badges.outputs.coverage_badge }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "${{ steps.badges.outputs.last_commit_badge }}" >> $GITHUB_STEP_SUMMARY
