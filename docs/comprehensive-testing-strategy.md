# frys å·¥ä¸šçº§æµ‹è¯•ç­–ç•¥

## ğŸ¯ æ¦‚è¿°

frys ä½œä¸ºè½»é‡çº§ç°ä»£åŒ–å·¥ä½œæµç³»ç»Ÿï¼Œé‡‡ç”¨ä¸¥æ ¼çš„å·¥ä¸šçº§æµ‹è¯•ç­–ç•¥ï¼Œç¡®ä¿ç³»ç»Ÿçš„é«˜è´¨é‡ã€é«˜å¯é æ€§å’Œé«˜æ€§èƒ½ã€‚æœ¬æµ‹è¯•ç­–ç•¥éµå¾ªç°ä»£è½¯ä»¶å·¥ç¨‹æœ€ä½³å®è·µï¼Œæ¶µç›–å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€æ€§èƒ½æµ‹è¯•ã€ç«¯åˆ°ç«¯æµ‹è¯•ç­‰å…¨æ–¹ä½æµ‹è¯•ç»´åº¦ã€‚

## ğŸ“Š æµ‹è¯•è¦†ç›–ç›®æ ‡

### æ ¸å¿ƒæŒ‡æ ‡

- **å•å…ƒæµ‹è¯•è¦†ç›–ç‡**: â‰¥ 90%
- **é›†æˆæµ‹è¯•è¦†ç›–**: 100% æ ¸å¿ƒæµç¨‹
- **æ€§èƒ½åŸºå‡†**: å“åº”æ—¶é—´ < 50ms (P95)
- **é”™è¯¯ç‡**: < 0.1%
- **å¯ç”¨æ€§**: 99.9% SLA

### æµ‹è¯•ç±»å‹åˆ†å¸ƒ

- å•å…ƒæµ‹è¯•: 70%
- é›†æˆæµ‹è¯•: 20%
- ç«¯åˆ°ç«¯æµ‹è¯•: 5%
- æ€§èƒ½æµ‹è¯•: 3%
- å®‰å…¨æµ‹è¯•: 2%

## ğŸ—ï¸ æµ‹è¯•æ¶æ„

### æµ‹è¯•é‡‘å­—å¡”æ¨¡å‹

```
ç«¯åˆ°ç«¯æµ‹è¯• (E2E)     5%
    â†—
é›†æˆæµ‹è¯• (Integration) 20%
    â†—
å•å…ƒæµ‹è¯• (Unit)       70%
    â†—
é™æ€åˆ†æ (Lint)     5%
```

### æµ‹è¯•æŠ€æœ¯æ ˆ

- **æµ‹è¯•æ¡†æ¶**: Vitest (ç°ä»£ã€å¿«é€Ÿ)
- **æ–­è¨€åº“**: å†…ç½® expect API
- **æ¨¡æ‹Ÿå·¥å…·**: è½»é‡çº§ mocking
- **è¦†ç›–ç‡**: Istanbul/nyc
- **æ€§èƒ½æµ‹è¯•**: è‡ªå®šä¹‰åŸºå‡†æµ‹è¯•
- **E2Eæµ‹è¯•**: Playwright (è®¡åˆ’)

## ğŸ“‹ æµ‹è¯•è®¡åˆ’

### 1. å•å…ƒæµ‹è¯• (Unit Tests)

#### ç›®æ ‡

ä¸ºæ¯ä¸ªæ ¸å¿ƒæ¨¡å—ç¼–å†™å…¨é¢çš„å•å…ƒæµ‹è¯•ï¼Œç¡®ä¿å•ä¸ªç»„ä»¶çš„æ­£ç¡®æ€§ã€‚

#### æµ‹è¯•èŒƒå›´

- **26ä¸ªæ ¸å¿ƒæ¨¡å—**: æ¯ä¸ªæ¨¡å— â‰¥ 10ä¸ªæµ‹è¯•ç”¨ä¾‹
- **æ„é€ å‡½æ•°**: åˆå§‹åŒ–é€»è¾‘éªŒè¯
- **æ ¸å¿ƒæ–¹æ³•**: ä¸»è¦APIåŠŸèƒ½æµ‹è¯•
- **è¾¹ç•Œæ¡ä»¶**: å¼‚å¸¸å¤„ç†å’Œè¾¹ç•Œå€¼
- **é…ç½®é€‰é¡¹**: å‚æ•°éªŒè¯å’Œé»˜è®¤å€¼

#### æµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹

```javascript
describe('NATSInspiredMessaging', () => {
  it('åº”è¯¥èƒ½åˆ›å»ºè¿æ¥', async () => {
    const nats = new NATSInspiredMessaging();
    const connection = await nats.connect('test-cluster');
    expect(connection).toBeDefined();
    expect(connection.cluster).toBe('test-cluster');
  });

  it('åº”è¯¥èƒ½å‘å¸ƒå’Œè®¢é˜…æ¶ˆæ¯', async () => {
    const nats = new NATSInspiredMessaging();
    await nats.connect('test-cluster');

    let receivedMessage = null;
    nats.subscribe('test.topic', (msg) => {
      receivedMessage = msg;
    });

    await nats.publish('test.topic', { data: 'test' });

    // å¼‚æ­¥éªŒè¯
    await new Promise((resolve) => setTimeout(resolve, 10));
    expect(receivedMessage).toEqual({ data: 'test' });
  });
});
```

### 2. é›†æˆæµ‹è¯• (Integration Tests)

#### ç›®æ ‡

éªŒè¯æ¨¡å—é—´çš„åä½œå’Œæ•°æ®æµï¼Œç¡®ä¿ç³»ç»Ÿæ•´ä½“åŠŸèƒ½æ­£ç¡®ã€‚

#### æµ‹è¯•åœºæ™¯

- **å·¥ä½œæµæ‰§è¡Œ**: éœ€æ±‚ â†’ æ‹†è§£ â†’ å®ç° â†’ æµ‹è¯• â†’ éƒ¨ç½²
- **æ•°æ®æµ**: è¾“å…¥å¤„ç† â†’ å­˜å‚¨ â†’ æ£€ç´¢ â†’ è¾“å‡º
- **æœåŠ¡åä½œ**: å¤šä¸ªæ¨¡å—ååŒå·¥ä½œåœºæ™¯
- **é…ç½®ä¼ é€’**: å…¨å±€é…ç½®åœ¨æ¨¡å—é—´çš„ä¼ é€’

#### é›†æˆæµ‹è¯•å¥—ä»¶

```javascript
describe('å·¥ä½œæµé›†æˆæµ‹è¯•', () => {
  it('åº”è¯¥èƒ½å®Œæˆå®Œæ•´çš„å·¥ä½œæµ', async () => {
    // 1. åˆ›å»ºéœ€æ±‚ (æ¨¡æ‹Ÿ)
    const requirement = { id: 'req-001', title: 'ç”¨æˆ·ç™»å½•åŠŸèƒ½' };

    // 2. å­˜å‚¨éœ€æ±‚
    const sqlite = new SQLiteInspiredDatabase();
    await sqlite.createTable('requirements', { columns: [...] });
    await sqlite.insert('requirements', requirement);

    // 3. åˆ›å»ºä»»åŠ¡åˆ†è§£
    const tasks = [
      { id: 'task-001', requirementId: 'req-001', type: 'backend' },
      { id: 'task-002', requirementId: 'req-001', type: 'frontend' }
    ];

    // 4. æ‰§è¡Œæµ‹è¯•
    const vitest = new VitestInspiredTesting();
    vitest.runTest('integration', 'workflow-execution', () => {
      expect(tasks.length).toBe(2);
      expect(tasks[0].requirementId).toBe('req-001');
    });

    // 5. ç”ŸæˆæŠ¥å‘Š
    const report = {
      requirementId: 'req-001',
      tasksCompleted: tasks.length,
      testsPassed: vitest.getStats().passed
    };

    expect(report.tasksCompleted).toBe(2);
    expect(report.testsPassed).toBe(1);
  });
});
```

### 3. æ€§èƒ½æµ‹è¯• (Performance Tests)

#### ç›®æ ‡

ç¡®ä¿ç³»ç»Ÿåœ¨é«˜è´Ÿè½½ä¸‹çš„æ€§èƒ½è¡¨ç°ï¼ŒéªŒè¯æ€§èƒ½åŸºå‡†ã€‚

#### æ€§èƒ½æŒ‡æ ‡

- **å“åº”æ—¶é—´**: APIè°ƒç”¨ < 50ms (P95)
- **å†…å­˜ä½¿ç”¨**: < 100MB (å¸¸é©»å†…å­˜)
- **CPUä½¿ç”¨**: < 20% (å¹³å‡è´Ÿè½½)
- **å¹¶å‘å¤„ç†**: 1000+ å¹¶å‘è¯·æ±‚/ç§’

#### æ€§èƒ½æµ‹è¯•åœºæ™¯

```javascript
describe('æ€§èƒ½åŸºå‡†æµ‹è¯•', () => {
  it('åº”è¯¥åœ¨é«˜è´Ÿè½½ä¸‹ä¿æŒæ€§èƒ½', async () => {
    const axios = new AxiosInspiredHTTP();
    const instance = axios.create({ baseURL: 'http://localhost:3000' });

    const startTime = performance.now();
    const promises = [];

    // å¹¶å‘1000ä¸ªè¯·æ±‚
    for (let i = 0; i < 1000; i++) {
      promises.push(axios.get(instance.id, `/api/test/${i}`));
    }

    const results = await Promise.all(promises);
    const endTime = performance.now();

    const totalTime = endTime - startTime;
    const avgTime = totalTime / 1000;

    console.log(`å¹¶å‘1000è¯·æ±‚æ€»æ—¶é—´: ${totalTime}ms`);
    console.log(`å¹³å‡å“åº”æ—¶é—´: ${avgTime}ms`);

    expect(avgTime).toBeLessThan(50); // P95 < 50ms
    expect(results.filter((r) => r.status === 200).length).toBe(1000);
  });
});
```

### 4. ç«¯åˆ°ç«¯æµ‹è¯• (E2E Tests)

#### ç›®æ ‡

æ¨¡æ‹ŸçœŸå®ç”¨æˆ·åœºæ™¯ï¼ŒéªŒè¯å®Œæ•´çš„åŠŸèƒ½æµç¨‹ã€‚

#### E2Eæµ‹è¯•åœºæ™¯

- **ç”¨æˆ·æ³¨å†Œç™»å½•æµç¨‹**
- **å·¥ä½œæµåˆ›å»ºå’Œæ‰§è¡Œ**
- **æ•°æ®å¯¼å…¥å¯¼å‡º**
- **ç³»ç»Ÿé…ç½®ç®¡ç†**
- **ç›‘æ§å’ŒæŠ¥å‘Šç”Ÿæˆ**

### 5. é™æ€åˆ†ææµ‹è¯• (Static Analysis)

#### ç›®æ ‡

é€šè¿‡ä»£ç è´¨é‡æ£€æŸ¥ç¡®ä¿ä»£ç è§„èŒƒå’Œæœ€ä½³å®è·µã€‚

#### æ£€æŸ¥é¡¹

- **ESLintè§„åˆ™**: ä»£ç é£æ ¼å’Œé”™è¯¯æ£€æµ‹
- **JSDocå®Œæ•´æ€§**: APIæ–‡æ¡£è¦†ç›–
- **ç±»å‹å®‰å…¨**: å‚æ•°å’Œè¿”å›å€¼ç±»å‹æ£€æŸ¥
- **å®‰å…¨æ¼æ´**: æ½œåœ¨å®‰å…¨é£é™©æ‰«æ

## ğŸ”§ æµ‹è¯•åŸºç¡€è®¾æ–½

### æµ‹è¯•è„šæœ¬é…ç½® (package.json)

```json
{
  "scripts": {
    "test": "vitest run",
    "test:watch": "vitest",
    "test:coverage": "vitest run --coverage",
    "test:integration": "vitest run tests/integration/",
    "test:performance": "node scripts/benchmark.js",
    "test:e2e": "playwright test",
    "test:all": "npm run test && npm run test:integration && npm run test:performance"
  }
}
```

### æµ‹è¯•æ–‡ä»¶ç»“æ„

```
tests/
â”œâ”€â”€ unit/                    # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ core/               # æ ¸å¿ƒæ¨¡å—æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ nats.test.js
â”‚   â”‚   â”œâ”€â”€ axios.test.js
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ utils/              # å·¥å…·å‡½æ•°æµ‹è¯•
â”œâ”€â”€ integration/            # é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ workflows.test.js
â”‚   â””â”€â”€ api.test.js
â”œâ”€â”€ e2e/                    # ç«¯åˆ°ç«¯æµ‹è¯•
â”‚   â””â”€â”€ user-journey.test.js
â”œâ”€â”€ performance/            # æ€§èƒ½æµ‹è¯•
â”‚   â””â”€â”€ benchmarks.test.js
â””â”€â”€ fixtures/               # æµ‹è¯•æ•°æ®
```

### æµ‹è¯•é…ç½® (vitest.config.js)

```javascript
import { defineConfig } from 'vitest/config';

export default defineConfig({
  test: {
    environment: 'node',
    setupFiles: ['./tests/setup.js'],
    coverage: {
      reporter: ['text', 'json', 'html'],
      exclude: ['node_modules/', 'tests/'],
      thresholds: {
        global: {
          branches: 80,
          functions: 80,
          lines: 80,
          statements: 80,
        },
      },
    },
    testTimeout: 10000,
    maxConcurrency: 5,
  },
});
```

## ğŸ“ˆ æµ‹è¯•æ‰§è¡Œæµç¨‹

### 1. æœ¬åœ°å¼€å‘æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•
npm test

# å¸¦è¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage

# ç›‘å¬æ¨¡å¼å¼€å‘
npm run test:watch
```

### 2. CI/CD é›†æˆæµ‹è¯•

```yaml
# .github/workflows/ci.yml
name: CI
on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
      - run: npm ci
      - run: npm run test:all
      - run: npm run test:coverage
```

### 3. æ€§èƒ½å›å½’æµ‹è¯•

```bash
# æ€§èƒ½åŸºå‡†æµ‹è¯•
npm run test:performance

# å¯¹æ¯”æ€§èƒ½æŠ¥å‘Š
# è‡ªåŠ¨æ£€æµ‹æ€§èƒ½é€€åŒ–
```

## ğŸ¯ æµ‹è¯•è´¨é‡ä¿è¯

### ä»£ç å®¡æŸ¥æ ‡å‡†

- **æµ‹è¯•ç”¨ä¾‹å®Œæ•´æ€§**: æ¯ä¸ªåŠŸèƒ½éƒ½æœ‰å¯¹åº”æµ‹è¯•
- **è¾¹ç•Œæ¡ä»¶è¦†ç›–**: åŒ…å«å¼‚å¸¸å’Œè¾¹ç•Œæƒ…å†µ
- **æµ‹è¯•å‘½åè§„èŒƒ**: describe/it ä½¿ç”¨æ¸…æ™°çš„æè¿°
- **æµ‹è¯•ç‹¬ç«‹æ€§**: å„æµ‹è¯•ç”¨ä¾‹ç›¸äº’ç‹¬ç«‹

### æŒç»­æ”¹è¿›

- **æµ‹è¯•ç”¨ä¾‹ç»´æŠ¤**: éšä»£ç å˜æ›´æ›´æ–°æµ‹è¯•
- **æ€§èƒ½ç›‘æ§**: å®šæœŸæ£€æŸ¥æ€§èƒ½åŸºå‡†
- **è¦†ç›–ç‡ç›®æ ‡**: ä¿æŒé«˜æµ‹è¯•è¦†ç›–ç‡
- **æµ‹è¯•é‡æ„**: ä¼˜åŒ–æµ‹è¯•ä»£ç è´¨é‡

## ğŸ“Š æµ‹è¯•æŠ¥å‘Šå’Œç›‘æ§

### è¦†ç›–ç‡æŠ¥å‘Š

- **HTMLæŠ¥å‘Š**: è¯¦ç»†çš„ä»£ç è¦†ç›–æƒ…å†µ
- **JSONæŠ¥å‘Š**: CI/CD é›†æˆä½¿ç”¨
- **è¶‹åŠ¿åˆ†æ**: è¦†ç›–ç‡å˜åŒ–è¶‹åŠ¿

### æ€§èƒ½ç›‘æ§

- **å“åº”æ—¶é—´å›¾è¡¨**: APIæ€§èƒ½è¶‹åŠ¿
- **å†…å­˜ä½¿ç”¨ç›‘æ§**: å†…å­˜æ³„æ¼æ£€æµ‹
- **é”™è¯¯ç‡ç»Ÿè®¡**: ç³»ç»Ÿç¨³å®šæ€§æŒ‡æ ‡

### æµ‹è¯•ä»ªè¡¨æ¿

```
æµ‹è¯•è¦†ç›–ç‡: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 85%
å•å…ƒæµ‹è¯•:    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘ 92%
é›†æˆæµ‹è¯•:    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 82%
æ€§èƒ½æµ‹è¯•:    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 98%

æœ€è¿‘æµ‹è¯•ç»“æœ:
âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ (1523/1523)
âš ï¸  æ€§èƒ½è­¦å‘Š: å“åº”æ—¶é—´ +5ms
ğŸ“ˆ è¦†ç›–ç‡æå‡: +2.1%
```

## ğŸš€ å®æ–½è®¡åˆ’

### Phase 1: åŸºç¡€æµ‹è¯•æ¡†æ¶ (Week 1-2)

- [ ] è®¾ç½® Vitest æµ‹è¯•ç¯å¢ƒ
- [ ] åˆ›å»ºæµ‹è¯•åŸºç¡€ç»“æ„
- [ ] ç¼–å†™æ ¸å¿ƒæ¨¡å—å•å…ƒæµ‹è¯•
- [ ] é…ç½®è¦†ç›–ç‡æŠ¥å‘Š

### Phase 2: é›†æˆæµ‹è¯• (Week 3-4)

- [ ] å®ç°é›†æˆæµ‹è¯•å¥—ä»¶
- [ ] æµ‹è¯•æ¨¡å—é—´åä½œ
- [ ] éªŒè¯æ•°æ®æµå®Œæ•´æ€§
- [ ] å»ºç«‹é›†æˆæµ‹è¯•åŸºå‡†

### Phase 3: æ€§èƒ½å’ŒE2Eæµ‹è¯• (Week 5-6)

- [ ] å®æ–½æ€§èƒ½æµ‹è¯•å¥—ä»¶
- [ ] åˆ›å»ºE2Eæµ‹è¯•åœºæ™¯
- [ ] ä¼˜åŒ–æ€§èƒ½ç“¶é¢ˆ
- [ ] éªŒè¯ç«¯åˆ°ç«¯æµç¨‹

### Phase 4: CI/CDå’Œç›‘æ§ (Week 7-8)

- [ ] é›†æˆGitHub Actions
- [ ] é…ç½®è‡ªåŠ¨åŒ–æµ‹è¯•
- [ ] å»ºç«‹æ€§èƒ½ç›‘æ§
- [ ] å®Œå–„æµ‹è¯•æŠ¥å‘Š

## ğŸ‰ æˆåŠŸæ ‡å‡†

### é‡åŒ–æŒ‡æ ‡

- âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 90%
- âœ… é›†æˆæµ‹è¯•é€šè¿‡ç‡ 100%
- âœ… æ€§èƒ½åŸºå‡†è¾¾æ ‡ (P95 < 50ms)
- âœ… ESLint é›¶é”™è¯¯
- âœ… CI/CD è‡ªåŠ¨åŒ–æµ‹è¯•é€šè¿‡

### è´¨é‡ä¿è¯

- ğŸ”’ ä»£ç å®¡æŸ¥è¦æ±‚æµ‹è¯•è¦†ç›–
- ğŸ“ˆ æ€§èƒ½å›å½’è‡ªåŠ¨æ£€æµ‹
- ğŸ›¡ï¸ å®‰å…¨æ¼æ´æ‰«æé›†æˆ
- ğŸ“Š è¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ

---

**ğŸ† frys å·¥ä¸šçº§æµ‹è¯•ç­–ç•¥ - ç¡®ä¿é«˜è´¨é‡çš„ç°ä»£åŒ–å·¥ä½œæµç³»ç»Ÿ**

æœ¬æµ‹è¯•ç­–ç•¥å°†ç¡®ä¿ frys è¾¾åˆ°ä¼ä¸šçº§è´¨é‡æ ‡å‡†ï¼Œä¸ºç”¨æˆ·æä¾›å¯é ã€é«˜æ€§èƒ½çš„å¼€å‘å·¥å…·å¹³å°ã€‚ğŸš€
