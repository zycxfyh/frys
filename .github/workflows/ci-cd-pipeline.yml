name: ğŸš€ frys CI/CD Pipeline

# è§¦å‘æ¡ä»¶
on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]
  workflow_dispatch:
    inputs:
      environment:
        description: 'éƒ¨ç½²ç¯å¢ƒ'
        required: true
        default: 'staging'
        type: choice
        options:
          - staging
          - production
      skip_tests:
        description: 'è·³è¿‡æµ‹è¯•'
        required: false
        type: boolean
        default: false

# ç¯å¢ƒå˜é‡
env:
  NODE_VERSION: '18'
  DOCKER_BUILDKIT: 1
  COMPOSE_DOCKER_CLI_BUILD: 1

# å¹¶å‘æ§åˆ¶ - é¿å…åŒæ—¶è¿è¡Œå¤šä¸ªéƒ¨ç½²
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: ${{ github.ref != 'refs/heads/main' }}

jobs:
  # 1ï¸âƒ£ æœ¬åœ°éªŒè¯ - å¿«é€Ÿä»£ç è´¨é‡æ£€æŸ¥
  local-validation:
    name: '1ï¸âƒ£ æœ¬åœ°éªŒè¯'
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: ğŸ› ï¸ è®¾ç½® Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ğŸ“¦ å®‰è£…ä¾èµ–
        run: npm ci

      - name: ğŸ” ESLint æ£€æŸ¥
        run: npm run lint -- --quiet --max-warnings=0

      - name: ğŸ¨ Prettier æ ¼å¼æ£€æŸ¥
        run: npm run format:check

      - name: ğŸ“‹ æäº¤ä¿¡æ¯æ ¼å¼æ£€æŸ¥
        if: github.event_name == 'pull_request'
        run: |
          if ! echo "${{ github.event.pull_request.title }}" | grep -E "^(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert)(\(.+\))?: .{1,}" > /dev/null; then
            echo "âŒ PRæ ‡é¢˜æ ¼å¼ä¸ç¬¦åˆè§„èŒƒ: ${{ github.event.pull_request.title }}"
            echo "è¯·ä½¿ç”¨: type(scope): description"
            echo "ä¾‹å¦‚: feat(auth): add login validation"
            exit 1
          fi

      - name: ğŸ·ï¸ ä¸Šä¼  ESLint ç»“æœ
        uses: actions/upload-artifact@v4
        if: failure()
        with:
          name: eslint-results
          path: eslint-results.json
          retention-days: 7

  # 2ï¸âƒ£ è‡ªåŠ¨åŒ–æµ‹è¯• - å…¨é¢æµ‹è¯•å¥—ä»¶
  automated-testing:
    name: '2ï¸âƒ£ è‡ªåŠ¨åŒ–æµ‹è¯•'
    runs-on: ubuntu-latest
    timeout-minutes: 20
    needs: local-validation

    services:
      postgres:
        image: postgres:15
        env:
          POSTGRES_PASSWORD: test_password
          POSTGRES_DB: test_db
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5

      redis:
        image: redis:7-alpine
        options: >-
          --health-cmd "redis-cli ping"
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5

    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: ğŸ› ï¸ è®¾ç½® Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ğŸ“¦ å®‰è£…ä¾èµ–
        run: npm ci

      - name: ğŸ§ª å•å…ƒæµ‹è¯•
        run: npm run test:ci:unit
        env:
          NODE_ENV: test

      - name: ğŸ”— é›†æˆæµ‹è¯•
        run: npm run test:ci:integration
        env:
          DATABASE_URL: postgresql://postgres:test_password@localhost:5432/test_db
          REDIS_URL: redis://localhost:6379

      - name: âš¡ æ€§èƒ½æµ‹è¯•
        run: npm run test:performance:ci
        continue-on-error: true

      - name: ğŸ“Š ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
        run: npm run test:report

      - name: ğŸ·ï¸ ä¸Šä¼ æµ‹è¯•ç»“æœ
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: test-results-${{ github.run_id }}
          path: |
            test-results/
            reports/
          retention-days: 30

      - name: ğŸ“ˆ ä¸Šä¼ è¦†ç›–ç‡åˆ° Codecov
        uses: codecov/codecov-action@v4
        with:
          file: ./coverage/lcov.info
          flags: unittests
          name: codecov-umbrella
          fail_ci_if_error: false

  # 3ï¸âƒ£ å®‰å…¨æ£€æŸ¥ - ä¾èµ–å’Œä»£ç å®‰å…¨æ‰«æ
  security-checks:
    name: '3ï¸âƒ£ å®‰å…¨æ£€æŸ¥'
    runs-on: ubuntu-latest
    timeout-minutes: 15
    needs: local-validation

    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # éœ€è¦å®Œæ•´å†å²ç”¨äºå®‰å…¨æ‰«æ

      - name: ğŸ› ï¸ è®¾ç½® Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ğŸ“¦ å®‰è£…ä¾èµ–
        run: npm ci

      - name: ğŸ”’ npm å®¡è®¡
        run: npm audit --audit-level moderate
        continue-on-error: true

      - name: ğŸ›¡ï¸ å·¥ä¸šçº§å®‰å…¨å®¡è®¡
        run: node scripts/security-audit.js --ci
        env:
          CI: true

      - name: ğŸ” CodeQL åˆ†æ
        uses: github/codeql-action/init@v3
        with:
          languages: javascript

      - name: ğŸš€ æ‰§è¡Œ CodeQL åˆ†æ
        uses: github/codeql-action/analyze@v3
        with:
          category: '/language:javascript'

      - name: ğŸ·ï¸ ä¸Šä¼ å®‰å…¨å®¡è®¡ç»“æœ
        uses: actions/upload-artifact@v4
        with:
          name: security-audit-results
          path: security-audit-report.json
          retention-days: 30

  # 4ï¸âƒ£ é›†æˆæµ‹è¯• - ç«¯åˆ°ç«¯å’Œç¯å¢ƒæµ‹è¯•
  integration-testing:
    name: '4ï¸âƒ£ é›†æˆæµ‹è¯•'
    runs-on: ubuntu-latest
    timeout-minutes: 25
    needs: [automated-testing, security-checks]

    services:
      postgres:
        image: postgres:15
        env:
          POSTGRES_PASSWORD: test_password
          POSTGRES_DB: test_db
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5

      redis:
        image: redis:7-alpine
        options: >-
          --health-cmd "redis-cli ping"
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5

    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: ğŸ› ï¸ è®¾ç½® Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ğŸ“¦ å®‰è£…ä¾èµ–
        run: npm ci

      - name: ğŸ—ï¸ æ„å»ºåº”ç”¨
        run: npm run build

      - name: ğŸŒ å¯åŠ¨æµ‹è¯•ç¯å¢ƒ
        run: |
          docker-compose -f docker-compose.staging.yml up -d --build
          timeout 300 bash -c 'until curl -f http://localhost:3000/health; do sleep 5; done'

      - name: ğŸ­ ç«¯åˆ°ç«¯æµ‹è¯•
        run: npm run test:e2e:ci
        env:
          BASE_URL: http://localhost:3000
        continue-on-error: true

      - name: ğŸ”„ API é›†æˆæµ‹è¯•
        run: npm run test:e2e:api
        env:
          API_BASE_URL: http://localhost:3000/api

      - name: ğŸ¨ è§†è§‰å›å½’æµ‹è¯•
        run: npm run test:visual
        continue-on-error: true

      - name: â™¿ æ— éšœç¢æµ‹è¯•
        run: npm run test:accessibility
        continue-on-error: true

      - name: ğŸ§¹ æ¸…ç†æµ‹è¯•ç¯å¢ƒ
        if: always()
        run: docker-compose -f docker-compose.staging.yml down -v

      - name: ğŸ·ï¸ ä¸Šä¼ é›†æˆæµ‹è¯•ç»“æœ
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: integration-test-results
          path: |
            playwright-report/
            test-results/
          retention-days: 30

  # 5ï¸âƒ£ PRå®¡æ ¸ - ä»£ç å®¡æŸ¥å’Œåˆè§„æ£€æŸ¥
  pr-review:
    name: '5ï¸âƒ£ PRå®¡æ ¸'
    runs-on: ubuntu-latest
    timeout-minutes: 10
    if: github.event_name == 'pull_request'
    needs: [automated-testing, security-checks, integration-testing]

    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ› ï¸ è®¾ç½® Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ğŸ“¦ å®‰è£…ä¾èµ–
        run: npm ci

      - name: ğŸ“‹ PR æ£€æŸ¥
        run: node scripts/pr-check.js --pr ${{ github.event.pull_request.number }}
        env:
          PR_NUMBER: ${{ github.event.pull_request.number }}
          GITHUB_HEAD_REF: ${{ github.head_ref }}
          GITHUB_BASE_REF: ${{ github.base_ref }}

      - name: ğŸ“Š è´¨é‡æ£€æŸ¥
        run: npm run quality:ci

      - name: ğŸ” ä»£ç å®¡æŸ¥æ£€æŸ¥
        uses: dorny/paths-filter@v3
        id: changes
        with:
          filters: |
            core:
              - 'src/core/**'
            security:
              - 'SECURITY.md'
              - 'scripts/security-audit.js'
            tests:
              - 'tests/**'

      - name: âš ï¸ æ ¸å¿ƒä»£ç å˜æ›´è­¦å‘Š
        if: steps.changes.outputs.core == 'true'
        run: |
          echo "âš ï¸ æ£€æµ‹åˆ°æ ¸å¿ƒä»£ç å˜æ›´ï¼Œéœ€è¦é¢å¤–å®¡æŸ¥"
          echo "è¯·ç¡®ä¿ï¼š"
          echo "- æ‰€æœ‰æµ‹è¯•é€šè¿‡"
          echo "- æ€§èƒ½åŸºå‡†æµ‹è¯•æ— æ˜¾è‘—ä¸‹é™"
          echo "- å®‰å…¨å®¡è®¡æ— æ–°å¢æ¼æ´"

      - name: ğŸ”’ å®‰å…¨ç›¸å…³å˜æ›´è­¦å‘Š
        if: steps.changes.outputs.security == 'true'
        run: |
          echo "ğŸ”’ æ£€æµ‹åˆ°å®‰å…¨ç›¸å…³å˜æ›´"
          echo "è¯·ç¡®ä¿ï¼š"
          echo "- å®‰å…¨å®¡è®¡å·²å®¡æŸ¥"
          echo "- æ²¡æœ‰å¼•å…¥æ–°çš„å®‰å…¨é£é™©"

      - name: ğŸ§ª æµ‹è¯•è¦†ç›–ç‡æ£€æŸ¥
        run: |
          if [ $(jq '.total.lines.pct' < coverage/coverage-summary.json) -lt 80 ]; then
            echo "âŒ æµ‹è¯•è¦†ç›–ç‡ä½äº 80%: $(jq '.total.lines.pct' < coverage/coverage-summary.json)%"
            exit 1
          fi

  # 6ï¸âƒ£ Stagingéƒ¨ç½² - æµ‹è¯•ç¯å¢ƒè‡ªåŠ¨éƒ¨ç½²
  staging-deployment:
    name: '6ï¸âƒ£ Stagingéƒ¨ç½²'
    runs-on: ubuntu-latest
    timeout-minutes: 30
    if: (github.ref == 'refs/heads/develop' && github.event_name == 'push') || (github.event_name == 'workflow_dispatch' && inputs.environment == 'staging')
    needs: [automated-testing, security-checks, integration-testing]
    environment:
      name: staging
      url: ${{ steps.deploy.outputs.url }}

    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: ğŸ› ï¸ è®¾ç½® Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ğŸ“¦ å®‰è£…ä¾èµ–
        run: npm ci

      - name: ğŸ—ï¸ æ„å»ºåº”ç”¨
        run: npm run build:prod

      - name: ğŸ³ æ„å»º Docker é•œåƒ
        run: |
          docker build -t frys-staging:${{ github.sha }} .
          docker tag frys-staging:${{ github.sha }} frys-staging:latest

      - name: ğŸš€ éƒ¨ç½²åˆ° Staging
        run: |
          echo "éƒ¨ç½²åˆ° staging ç¯å¢ƒ..."
          # è¿™é‡Œå¯ä»¥é›†æˆå®é™…çš„éƒ¨ç½²å‘½ä»¤
          # ä¾‹å¦‚ï¼škubectlã€docker-composeã€AWSç­‰

      - name: âœ… éƒ¨ç½²éªŒè¯
        run: node scripts/verify-deployment.js
        env:
          DEPLOY_ENV: staging
          DEPLOY_URL: ${{ secrets.STAGING_URL }}

      - name: ğŸ“Š æ€§èƒ½åŸºå‡†æµ‹è¯•
        run: node scripts/performance-benchmark.js --baseline

      - name: ğŸ“ˆ SLO æ£€æŸ¥
        run: node scripts/slo-check.js --baseline
        env:
          DEPLOY_ENV: staging

      - name: ğŸ”” éƒ¨ç½²é€šçŸ¥
        if: always()
        run: |
          if [ ${{ job.status }} == 'success' ]; then
            echo "âœ… Staging éƒ¨ç½²æˆåŠŸ"
          else
            echo "âŒ Staging éƒ¨ç½²å¤±è´¥"
          fi

  # 7ï¸âƒ£ å›å½’æµ‹è¯• - ç”Ÿäº§éƒ¨ç½²åéªŒè¯
  regression-testing:
    name: '7ï¸âƒ£ å›å½’æµ‹è¯•'
    runs-on: ubuntu-latest
    timeout-minutes: 20
    if: github.ref == 'refs/heads/main' && github.event_name == 'push'
    needs: production-deployment

    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: ğŸ› ï¸ è®¾ç½® Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ğŸ“¦ å®‰è£…ä¾èµ–
        run: npm ci

      - name: ğŸ”„ å›å½’æµ‹è¯•çŸ©é˜µ
        run: node scripts/regression-matrix.js
        env:
          PRODUCTION_URL: ${{ secrets.PRODUCTION_URL }}
          API_BASE_URL: ${{ secrets.PRODUCTION_API_URL }}

      - name: ğŸ“Š æ€§èƒ½å›å½’æ£€æŸ¥
        run: node scripts/performance-monitor.js --regression
        env:
          DEPLOY_ENV: production

      - name: ğŸ” é”™è¯¯ç‡ç›‘æ§
        run: |
          # æ£€æŸ¥é”™è¯¯ç‡æ˜¯å¦åœ¨å¯æ¥å—èŒƒå›´å†…
          if [ $(curl -s ${{ secrets.PRODUCTION_HEALTH_URL }} | jq '.error_rate') -gt 0.05 ]; then
            echo "âŒ é”™è¯¯ç‡è¿‡é«˜: $(curl -s ${{ secrets.PRODUCTION_HEALTH_URL }} | jq '.error_rate')"
            exit 1
          fi

      - name: âœ… ä¸šåŠ¡åŠŸèƒ½éªŒè¯
        run: |
          # å…³é”®ä¸šåŠ¡æµç¨‹éªŒè¯
          npm run test:smoke:api

  # 8ï¸âƒ£ ç”Ÿäº§éƒ¨ç½² - è“ç»¿éƒ¨ç½²ç­–ç•¥
  production-deployment:
    name: '8ï¸âƒ£ ç”Ÿäº§éƒ¨ç½²'
    runs-on: ubuntu-latest
    timeout-minutes: 45
    if: github.ref == 'refs/heads/main' && github.event_name == 'push'
    needs: [automated-testing, security-checks, integration-testing, pr-review]
    environment:
      name: production
      url: ${{ steps.deploy.outputs.url }}

    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: ğŸ› ï¸ è®¾ç½® Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ğŸ“¦ å®‰è£…ä¾èµ–
        run: npm ci

      - name: ğŸ—ï¸ ç”Ÿäº§æ„å»º
        run: npm run build:prod
        env:
          NODE_ENV: production

      - name: ğŸ³ æ„å»ºç”Ÿäº§é•œåƒ
        run: |
          docker build -t frys-production:${{ github.sha }} .
          docker tag frys-production:${{ github.sha }} frys-production:latest

      - name: ğŸ” éªŒè¯éƒ¨ç½²æƒé™
        run: |
          # éªŒè¯æ˜¯å¦æœ‰ç”Ÿäº§éƒ¨ç½²æƒé™
          echo "éªŒè¯éƒ¨ç½²æƒé™..."

      - name: ğŸš€ è“ç»¿éƒ¨ç½²
        run: |
          echo "æ‰§è¡Œè“ç»¿éƒ¨ç½²..."
          # è¿™é‡Œè°ƒç”¨å®é™…çš„éƒ¨ç½²è„šæœ¬
          # ./scripts/deploy.sh --env production

      - name: ğŸ” éƒ¨ç½²åéªŒè¯
        run: node scripts/verify-deployment.js
        env:
          DEPLOY_ENV: production
          DEPLOY_URL: ${{ secrets.PRODUCTION_URL }}

      - name: ğŸ“Š éƒ¨ç½²æŒ‡æ ‡æ”¶é›†
        run: |
          echo "æ”¶é›†éƒ¨ç½²æŒ‡æ ‡..."
          # æ”¶é›†éƒ¨ç½²æ—¶é—´ã€æˆåŠŸç‡ç­‰æŒ‡æ ‡

      - name: ğŸ”” éƒ¨ç½²é€šçŸ¥
        if: always()
        run: |
          if [ ${{ job.status }} == 'success' ]; then
            echo "ğŸ‰ ç”Ÿäº§éƒ¨ç½²æˆåŠŸï¼"
          else
            echo "ğŸš¨ ç”Ÿäº§éƒ¨ç½²å¤±è´¥ï¼"
          fi

  # 9ï¸âƒ£ ç›‘æ§å›æº¯ - å®æ—¶ç›‘æ§å’Œè‡ªåŠ¨å›æ»š
  monitoring-rollback:
    name: '9ï¸âƒ£ ç›‘æ§å›æº¯'
    runs-on: ubuntu-latest
    timeout-minutes: 15
    if: github.ref == 'refs/heads/main' && github.event_name == 'push'
    needs: production-deployment

    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: ğŸ› ï¸ è®¾ç½® Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ğŸ“¦ å®‰è£…ä¾èµ–
        run: npm ci

      - name: ğŸ‘€ å¯åŠ¨å¥åº·ç›‘æ§
        run: node scripts/smart-rollback.js monitor --env production &
        env:
          HEALTH_CHECK_URL: ${{ secrets.PRODUCTION_HEALTH_URL }}

      - name: â±ï¸ ç›‘æ§è§‚å¯ŸæœŸ
        run: |
          echo "è§‚å¯Ÿéƒ¨ç½²åçš„ç³»ç»Ÿç¨³å®šæ€§..."
          sleep 300  # 5åˆ†é’Ÿè§‚å¯ŸæœŸ

      - name: ğŸ“Š å¥åº·çŠ¶æ€æ£€æŸ¥
        run: |
          health_status=$(node scripts/smart-rollback.js health)
          if echo "$health_status" | jq -e '.healthy == false' > /dev/null; then
            echo "âŒ æ£€æµ‹åˆ°å¥åº·é—®é¢˜ï¼Œè§¦å‘å›æ»š"
            node scripts/smart-rollback.js rollback environment_switch --reason "post-deployment health check failed"
            exit 1
          fi

      - name: ğŸ“ˆ æ€§èƒ½ç›‘æ§
        run: |
          # æ£€æŸ¥æ€§èƒ½æŒ‡æ ‡
          if node scripts/performance-monitor.js --check --threshold 0.9; then
            echo "âœ… æ€§èƒ½æŒ‡æ ‡æ­£å¸¸"
          else
            echo "âš ï¸ æ€§èƒ½ä¸‹é™ï¼Œè®°å½•è­¦å‘Š"
          fi

      - name: ğŸ”„ è‡ªåŠ¨å›æ»šæ£€æŸ¥
        run: node scripts/smart-rollback.js status
        env:
          DEPLOY_ENV: production

      - name: ğŸ·ï¸ ä¸Šä¼ ç›‘æ§ç»“æœ
        uses: actions/upload-artifact@v4
        with:
          name: monitoring-results
          path: |
            rollback-stats.json
            monitoring-report.json
          retention-days: 30

  # ğŸ¯ å·¥ä½œæµæ€»ç»“
  workflow-summary:
    name: 'ğŸ¯ å·¥ä½œæµæ€»ç»“'
    runs-on: ubuntu-latest
    if: always()
    needs:
      [
        local-validation,
        automated-testing,
        security-checks,
        integration-testing,
        pr-review,
        staging-deployment,
        regression-testing,
        production-deployment,
        monitoring-rollback,
      ]

    steps:
      - name: ğŸ“Š ç”Ÿæˆå·¥ä½œæµæŠ¥å‘Š
        run: |
          echo "# ğŸš€ frys CI/CD Pipeline æ‰§è¡ŒæŠ¥å‘Š" > workflow-report.md
          echo "" >> workflow-report.md
          echo "## æ‰§è¡Œæ‘˜è¦" >> workflow-report.md
          echo "- **è§¦å‘äº‹ä»¶**: ${{ github.event_name }}" >> workflow-report.md
          echo "- **åˆ†æ”¯**: ${{ github.ref }}" >> workflow-report.md
          echo "- **æäº¤**: ${{ github.sha }}" >> workflow-report.md
          echo "- **æ‰§è¡Œæ—¶é—´**: $(date)" >> workflow-report.md
          echo "" >> workflow-report.md
          echo "## é˜¶æ®µçŠ¶æ€" >> workflow-report.md
          echo "| é˜¶æ®µ | çŠ¶æ€ | æŒç»­æ—¶é—´ |" >> workflow-report.md
          echo "|------|------|----------|" >> workflow-report.md

          # è¿™é‡Œå¯ä»¥æ·»åŠ æ›´å¤šè¯¦ç»†çš„æŠ¥å‘Šç”Ÿæˆé€»è¾‘

      - name: ğŸ“¤ ä¸Šä¼ å·¥ä½œæµæŠ¥å‘Š
        uses: actions/upload-artifact@v4
        with:
          name: workflow-report
          path: workflow-report.md
          retention-days: 7

      - name: ğŸ‰ æˆåŠŸé€šçŸ¥
        if: success()
        run: |
          echo "ğŸ‰ æ‰€æœ‰ CI/CD é˜¶æ®µæ‰§è¡ŒæˆåŠŸï¼"
          echo "âœ… ä»£ç å·²æˆåŠŸéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ"

      - name: ğŸš¨ å¤±è´¥é€šçŸ¥
        if: failure()
        run: |
          echo "ğŸš¨ CI/CD æµæ°´çº¿æ‰§è¡Œå¤±è´¥"
          echo "è¯·æ£€æŸ¥ä¸Šè¿°é”™è¯¯ä¿¡æ¯å¹¶ä¿®å¤é—®é¢˜"
